---
title: "Guia R√°pido"
description: "Passo a passo para preparar, executar e validar o BackBet localmente."
slug: "/docs/quickstart"
---

# BackBet Quickstart

Checklist para sair do zero at√© um ambiente funcional com sa√∫de/observabilidade verificadas e testes em dia.

## 1. Pr√©-requisitos

- Node.js **20.x** (18 funciona, mas todas as automa√ß√µes rodam em 20) e npm **10+**
- Git + `tsc` (instalado via `npm install`)
- Docker 24+ (opcional, mas recomendado para MongoDB/Redis)
- Porta `3000` livre (override via `PORT`)

## 2. Clone e depend√™ncias

```bash
git clone https://github.com/<sua-org>/backbet.git
cd backbet
npm install
```

> Sempre use `npm install` (o projeto usa lockfile npm). `npm ci` √© recomendado em CI/CD.

## 3. Vari√°veis de ambiente

```bash
cp .env.example .env
```

Ajuste os principais toggles:

| Vari√°vel | O que faz | Valor t√≠pico em dev |
|----------|-----------|---------------------|
| `NODE_ENV` | Ambiente l√≥gico | `development` |
| `PORT` | Porta HTTP | `3000` |
| `USE_MONGOOSE_PERSISTENCE` | Liga reposit√≥rios Mongo/Mongoose | `false` se quiser in-memory |
| `MONGODB_URI` / `MONGODB_DB_NAME` | Conex√£o Mongo | `mongodb://localhost:27017` / `backbet-dev` |
| `CACHE_ENABLED` / `REDIS_URL` | Libera cache Redis + m√©tricas | `false` quando n√£o houver Redis |
| `ALLOW_DEV_BEARER_BYPASS` | Permite `Authorization: Bearer <userId>` sem JWT | `true` | 
| `CLERK_*` | Credenciais Clerk | Use valores reais s√≥ em staging/prod |
| `JWT_*` | Segredo/local auth | Necess√°rio para `/auth/login` e `/auth/refresh` |
| `RATE_LIMIT_*` | Rate limit global | Defaults altos (5k req/10 min) |
| `TRACING_ENABLED`, `OTEL_EXPORTER_OTLP_ENDPOINT` | OpenTelemetry | Ative apenas se tiver collector |

> Nunca versione `.env`. Para CI, configure secrets no provedor.

## 4. Depend√™ncias locais (Mongo + Redis)

Suba containers r√°pidos (pode usar Compose ou comandos simples):

```bash
docker run -d --name backbet-mongo -p 27017:27017 mongo:7
docker run -d --name backbet-redis -p 6379:6379 redis:7
```

Deseja Compose?

```yaml
services:
  mongo:
    image: mongo:7
    ports: ["27017:27017"]
  redis:
    image: redis:7
    ports: ["6379:6379"]
```

> Sem Mongo? defina `USE_MONGOOSE_PERSISTENCE=false`. Sem Redis? `CACHE_ENABLED=false`.

## 5. Executar em desenvolvimento

```bash
npm run dev
```

- Usa `tsx watch src/index.ts` com reload autom√°tico.
- O bootstrap (`src/index.ts`) inicia tracing antes de carregar o `ApiServer`.
- Logs s√£o JSON com `request_start`/`request_end`/`request_error` e sempre incluem `requestId`.

### Endpoints importantes

| URL | Descri√ß√£o |
|-----|-----------|
| `GET /health` | Heartbeat e uptime |
| `GET /readiness` | Consulta Redis/Mongo, atualiza gauges `backbet_dependency_health` |
| `GET /health/cache` | Exibe m√©tricas internas do `RedisClient` |
| `GET /metrics` | Prometheus/OpenMetrics |
| `GET /api/docs` | Swagger UI |
| `GET /api/docs.json` | OpenAPI 3.1 |

## 6. Scripts essenciais

| Comando | Uso |
|---------|-----|
| `npm run dev` | Desenvolvimento com hot reload |
| `npm run build` | `tsc` + `tsc-alias` para `dist/` |
| `npm start` | Executa `dist/index.js` (produ√ß√£o/staging) |
| `npm test` | 350 testes (unit + integra√ß√£o leve) |
| `npm run test -- --coverage` | Relat√≥rio completo de cobertura |
| `npm run lint` / `npm run lint:fix` | ESLint 9 + `@typescript-eslint` |
| `npm run format` | Prettier |
| `npm run migration:run` | Runner de migrations (Mongo) |
| `npm run seed:initial` / `npm run seed:credit-packages` | Seeds utilit√°rios |

## 7. Smoke test r√°pido

Ap√≥s `npm run dev` ou `npm start`:

```bash
curl -sf http://localhost:3000/health
curl -sf http://localhost:3000/readiness
curl -sf http://localhost:3000/api/docs.json | head -n 20
curl -sf http://localhost:3000/metrics | head -n 20
```

Cache habilitado?

```bash
curl -sf http://localhost:3000/health/cache
```

## 8. Testes, qualidade e build

1. `npm run lint`
2. `npm run test -- --coverage`
3. `npm run build`

> Essa trinca √© obrigat√≥ria antes de qualquer PR. `npm run build && npm start` garante que o bundle em `dist/` funciona.

## 9. Troubleshooting

| Sintoma | Corre√ß√£o |
|---------|----------|
| `Cannot find module` ao rodar `npm start` | Remova `dist/` e refa√ßa `npm run build`. Confirme `npm install` e tsconfig correto. |
| `ERR_UNKNOWN_FILE_EXTENSION` | Garanta que `package.json` **n√£o** tenha `"type": "module"`. |
| `MongoNetworkError` | Suba Mongo (`docker ps`), revise URI ou use `USE_MONGOOSE_PERSISTENCE=false`. |
| `Redis connection refused` | Corrija `REDIS_URL` ou desligue cache (`CACHE_ENABLED=false`). |
| `CLERK_*` faltando | Use chaves reais ou habilite `ALLOW_DEV_BEARER_BYPASS` (apenas em dev/test). |
| Testes inst√°veis | `npm test -- --clearCache && npm test`. Confira se servi√ßos externos n√£o est√£o caindo. |
| Porta 3000 ocupada | Ajuste `PORT` ou finalize processo (`lsof -i :3000`). |

## 10. Pr√≥ximos passos

1. Rodar `npm run lint && npm run test -- --coverage && npm run build` antes de commitar.
2. Atualizar documenta√ß√£o do m√≥dulo tocado em `docs/*.mdx` quando necess√°rio.
3. Em staging/prod: ative Redis real, conecte Mongo definitivo, defina `CLERK_*`, configure OTLP (`TRACING_ENABLED=true` + `OTEL_EXPORTER_OTLP_ENDPOINT`) e proteja `/metrics`/`/readiness` via proxy.

---

**√öltima atualiza√ß√£o:** 23 de novembro de 2025

Boa jornada e bons commits! üöÄ
